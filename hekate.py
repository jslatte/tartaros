####################################################################################################
#
# Copyright (c) by Jonathan Slattery for Apollo Video Technology
#
####################################################################################################



####################################################################################################
# Import Modules ###################################################################################
####################################################################################################
####################################################################################################

from Hekate import Hekate
from Sisyphus import Sisyphus
from logger import Logger
from utility import return_execution_error

####################################################################################################
# Globals ##########################################################################################
####################################################################################################
####################################################################################################

log = Logger()
sisyphus = Sisyphus

####################################################################################################
# Exception Handler ################################################################################
####################################################################################################
####################################################################################################


def handle_exception(log, e, operation=None):
    """ Handle an exception.
    INPUT
        e: the exception (from BaseException, e).
        operation: the action being attempted (that failed).
    """

    if operation is not None: log.error("Failed to %s." % operation)
    log.error(str(e))
    for error in e:
        log.error(str(error))
    exception = return_execution_error()['error']
    log.error("Error: %s." % exception)

####################################################################################################
# Run Hekate #######################################################################################
####################################################################################################
####################################################################################################

hekate = Hekate(log, handle_exception, sisyphus)

while True:
    try:
        hekate.run()

    except BaseException, e:
        log.error("Critical failure occurred.")
        log.error(str(e))
        continue